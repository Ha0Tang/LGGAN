## Contents

  - [Installation](#Installation)
  - [Dataset Preparation](#Dataset-Preparation)
  - [Generating Images Using Pretrained Model](#Generating-Images-Using-Pretrained-Model)
  - [Train and Test New Models](#Train-and-Test-New-Models)
  - [Evaluation](#Evaluation)

## Installation

Clone this repo.
```bash
git clone https://github.com/Ha0Tang/LGGAN
cd LGGAN/
```

This code requires PyTorch 1.0 and python 3+. Please install dependencies by
```bash
pip install -r requirements.txt
```

This code also requires the Synchronized-BatchNorm-PyTorch rep.
```
cd semantic_image_synthesis/;
cd models/networks/;
git clone https://github.com/vacancy/Synchronized-BatchNorm-PyTorch;
cp -rf Synchronized-BatchNorm-PyTorch/sync_batchnorm .;
cd ../../;
```

To reproduce the results reported in the paper, you would need an NVIDIA DGX1 machine with 8 V100 GPUs.

## Dataset Preparation
Please follow our [DAGAN](https://github.com/Ha0Tang/DAGAN#dataset-preparation) to directly download both Cityscapes and ADE20K datasets. This repository use the same dataset format as [DAGAN](https://github.com/Ha0Tang/DAGAN), [EdgeGAN](https://github.com/Ha0Tang/EdgeGAN) and [SelectionGAN](https://github.com/Ha0Tang/SelectionGAN/tree/master/semantic_synthesis). so you can use the same data for all these methods.

## Generating Images Using Pretrained Model
1. Download the pretrained models using the following script,
```
sh scripts/download_lggan_model.sh LGGAN_[dataset]
```
where `[dataset]` can be one of `cityscapes`, or `ade`.

***If the first download is unsuccessful, please try the second time!!!***

2. Change several parameter and then generate images using `test_[dataset].sh`. If you are running on CPU mode, append `--gpu_ids -1`.
3. The outputs images are stored at `./results/[type]_pretrained/` by default. You can view them using the autogenerated HTML file in the directory.

***Replace three `.py` files in the [ade20k](https://github.com/Ha0Tang/LGGAN/tree/master/semantic_image_synthesis/ade20k) folder to run experiments on ADE20K.***

## Train and Test New Models
1. Prepare dataset.
2. Change several parameters and then run `train_[dataset].sh` for training.
There are many options you can specify. To specify the number of GPUs to utilize, use `--gpu_ids`. If you want to use the second and third GPUs for example, use `--gpu_ids 1,2`.
3. Testing is similar to testing pretrained models. Use `--results_dir` to specify the output directory. `--how_many` will specify the maximum number of images to generate. By default, it loads the latest checkpoint. It can be changed using `--which_epoch`.

## Evaluation
Please follow our [DAGAN](https://github.com/Ha0Tang/DAGAN#evaluation) to evalute the trained models.